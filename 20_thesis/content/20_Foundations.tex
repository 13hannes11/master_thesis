\chapter{Foundations}
\label{ch:Foundations}

\todo[inline]{what is the chapter about}

\section{Neglected Tropical Diseases}
\label{sec:Foundations:NTDs}

\Acp{ntd} \cite{feasey2010neglected} are a biologically diverse group of diseases which mainly occur in tropical regions. The geographic location, however, is not linked to temperatures or climate but mainly as a result of a large part of the world's poorest population living in these regions. \Acp{ntd} affect approximately a sixth of the world population, yet, they have received less attention than other diseases. \textcite{feasey2010neglected} state that there are \acp{ntd} which have a high prevalence and excellent potential for successful control. Among these are Ascaris, hookworm, whipworm, and Schistosoma. These parasites are the ones present in the dataset used in this thesis. Ascaris, whipworm and hookworm are \acp{sth} which is a subclass of \acp{ntd}\todo{Source for subclass}.

\subsection{Soil-Transmitted Helminth} % Soil-Transmitted Helminths
\label{sec:Foundations:NTDs:STHs} 

Helminthic parasites which are mainly transmitted through soil are known as \aclp{sth} \cite{feasey2010neglected,jourdan2018soiltransmitted}. This section gives a more detailed introduction into \acp{sth} present in the dataset used in this thesis.


\subsubsection{Roundworm (Ascaris)}
\label{sec:Foundations:NTDs:STHs:Ascaris}

The roundworm (Ascaris) is the most common among \acp{sth} \cite{jamison2006helminth}. Upon oral ingestion ascaris eggs hatch and larvae move through the lungs to settle into the small intestine where they grow into adult worms \cite{jourdan2018soiltransmitted}. There they reproduce sexually and produce eggs which are expelled through human faeces. Eggs in warm, moist soil can infect other humans for years. An illustration of a roundworm can be seen in \autoref{fig:Foundations:NCLs:STHs:Ascaris}.

\subsubsection{Whipworm (Trichuris)}
\label{sec:Foundations:NTDs:STHs:Whipworm}

Like roundworms whipworms are also transmitted through the faecal-oral cycle, where eggs are ingested via food or hands \cite{jourdan2018soiltransmitted}. Whipworms also reproduce in the small intestine, however, unlike roundworms, they do not migrate through the lungs. \autoref{fig:Foundations:NCLs:STHs:Whipworm:Adult} shows an illustration of a whipworm.

\subsubsection{Hookworm (Necator Americanus and Ancylostoma Duodenale)}
\label{sec:Foundations:NTDs:STHs:Hookworm}

Unlike roundworms and whipworms, hookworms' eggs hatch after around 5-10 days outside the human body. Roundworm larva then infect humans by penetrating the skin through the feet \cite{jourdan2018soiltransmitted}. They then travel through the lungs into the voice box (larynx) where they are swallowed. Finally, hookworms, like roundworms and whipworms settle in the small intestine and produce eggs which leave the human body through faeces. An image of a hookworm larva can be seen in \autoref{fig:Foundations:NCLs:STHs:Hookworm:Adult}.

\begin{figure}
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/20_foundations/10_neglected_tropical/Ascaris_adult_enlarged.jpg}
        \caption{Illustration of a \textbf{roundworm} by \textcite{blainville1824traite}.}
        \label{fig:Foundations:NCLs:STHs:Ascaris}
        \vspace*{2mm}
    \end{subfigure}
    \hfill
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/20_foundations/10_neglected_tropical/Trichuris_trichiura_adult_female_enlarged.jpg}
        \caption{An illustration of a female \textbf{whipworm} by \textcite{blainville1824traite}.}
        \label{fig:Foundations:NCLs:STHs:Whipworm:Adult}
        \vspace*{2mm}
    \end{subfigure}
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/20_foundations/10_neglected_tropical/Hookworm_larva.jpg}
        \caption{\textbf{Hookworm} larva (from \textcite{dpdx2019hookworm}).}
        \label{fig:Foundations:NCLs:STHs:Hookworm:Adult}
    \end{subfigure}    
    \hfill
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/20_foundations/10_neglected_tropical/Schistosoma_adult_small.jpg}
        \caption{Electron micrograph of a male \textbf{Schistosoma} by \textcite{davidwilliams2009schistosoma}.}
        \label{fig:Foundations:NCLs:Schistosoma:Adult}
    \end{subfigure}
    \caption{An overview of parasitic worms. Roundworm, whipworm, hookworm, and Schistosoma (left to right, top to bottom).}
    \label{fig:Foundations:NCLs:Overview}
\end{figure}


\subsection{Schistosoma}
\label{sec:Foundations:NTDs:STHs:Schistosoma}

Schistosoma worms have the most complex life cycle among parasite covered in this thesis. Humans excrement contains its eggs \cite{nelwan2019schistosomiasis}. When eggs come into contact with water they hatch and infect snails. Infected snails shed cercariae which enter the human body through skin and migrate throughout the body using the circulating blood. The location where adult worms settle depends on the exact species, but some examples are the intestine (large and small), and the bladder. A picture of a Schistosoma worm can be seen in \autoref{fig:Foundations:NCLs:Schistosoma:Adult}.

\subsection{Diagnosis}
\label{sec:Foundations:NTDs:Diagnosis}

Schistosoma and \acp{sth} are commonly diagnosed by counting eggs present in a stool sample with a microscope. The technique used is called Kato-Katz \cite{nelwan2019schistosomiasis} and was introduced by \textcite{katz1972simple} which refined the method introduced by \citeauthor{kato1954comparative} \cite{kato1954comparative,kato1960correct}. The technique involves cardboard with a hole in it, some stainless-steel mesh-cloth, a cellophane membrane and glycerol. A sample first is pressed through the stainless steel mesh-cloth and then smeared through the hole onto the slide. Then the side is covered with a cellophane membrane and treated with glycerol \cite{mbongngwese2020diagnostic}. This technique gains fairly consistent measurements, is fairly reliable, easy to perform and low cost \cite{katz1972simple} and therefore considered to be the \ac{who} \say{gold standard} (according to \textcite{mbongngwese2020diagnostic}).
The slides prepared using the Kato-Katz are, after a resting period, examined under a light microscope to count the number of eggs per milligram. This allows to identify the intensity of infection of a patient \cite{feasey2010neglected}. 

Eggs found under a microscope can be assigned to the corresponding parasite worm based on size, shape, and colour. \emph{Roundworm (Ascaris)} eggs are identified by rounded thick shell with an external mamillated layer which is often stained with brown spots and has a length of \unit{45}{\micro\meter} to \unit{75}{\micro\meter} \cite{dpdx2019ascariasis} (as shown in \autoref{fig:Foundations:NCLs:Diagnosis:Ascaris:Egg}).
\emph{Whipworm} eggs (see \autoref{fig:Foundations:NCLs:Diagnosis:Whipworm:Egg}) can be identified by their elongated oval shape with two circular protrusions at the end of longer sides \cite{dpdx2017trichuriasis,larsson2020development}. A length of approximately \unit{50}{\micro\meter} and a width of \unit{20}{\micro\meter} characterizes the eggs.
\emph{Hookworm} eggs are thin-shelled and colourless with a blurry inner structure. The eggs' size measures \unit{65}{\micro\meter} by \unit{35}{\micro\meter} which is shown in \autoref{fig:Foundations:NCLs:Diagnosis:Hookworm:Egg} \cite{dpdx2019hookworm, larsson2020development}.
Lastly, the dataset contains \emph{Schistosoma} eggs (see \autoref{fig:Foundations:NCLs:Diagnosis:Schistosoma:Egg}). They are characterized by a spine (seen as a spike) 
and have a size of approximately \unit{100}{\micro\meter} by \unit{50}{\micro\meter} which can vary by species \cite{dpdx2019schistosomiasis, larsson2020development}.

\begin{figure}[tb]
    \centering
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/20_foundations/10_neglected_tropical/Ascaris_egg_fertilised.jpg}
        \caption{Fertilized \textbf{roundworm} egg from \textcite{dpdx2019ascariasis}.}
        \label{fig:Foundations:NCLs:Diagnosis:Ascaris:Egg}
        \vspace*{2mm}
    \end{subfigure}
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/20_foundations/10_neglected_tropical/Trichuris_trichiura_egg.jpg}
        \caption{\textbf{Whipworm} egg from \textcite{dpdx2017trichuriasis}.}
        \label{fig:Foundations:NCLs:Diagnosis:Whipworm:Egg}
        \vspace*{2mm}
    \end{subfigure}

    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/20_foundations/10_neglected_tropical/Hookworm_egg.jpg}
        \caption{\textbf{Hookworm} egg from \textcite{dpdx2019hookworm}.}
        \label{fig:Foundations:NCLs:Diagnosis:Hookworm:Egg}
    \end{subfigure}
    \begin{subfigure}[t]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/20_foundations/10_neglected_tropical/Schistosoma_egg.jpg}
        \caption{\textbf{Schistosoma} mansoni egg from \textcite{dpdx2019hookworm}.}
        \label{fig:Foundations:NCLs:Diagnosis:Schistosoma:Egg}
    \end{subfigure}
    \caption{An overview of parasitic worm eggs.}
    \label{fig:Foundations:NCLs:Diagnosis:Overview}
\end{figure}

\subsection{Whole-Slide Imaging}
\label{sec:Foundations:NTDs:WHoleSlideImaging}

\Ac{wsi} \cite{ghaznavi2013digital, hanna2019whole, el-gabry2014wholeslide} is a process in which slides are wholistically scanned to create a digital copy. This allows diagnostic processes to be more flexible as the collection of slides is independent of its analysis. Further, digitally archived slides do not suffer any degradation. 

A commonly used focus method for \ac{wsi} is \emph{z-stacking} \cite{el-gabry2014wholeslide} which is required for slides with larger variation in topology or which have a three-dimensional structure e.g., thick smears. A z-stack consists of multiple images taken at different focus planes. This allows a researcher to emulate the focusing behaviour of a conventional light microscope. \todo{Should example of a focus stack be added?}


\todo[inline]{add section labels}

\section{Machine Learning}

\begin{itemize}
    \item Supervised, unsupervised, semi-supervised learning
    \item (Transfer Learning)
    \item Training testing and validation:
    \begin{itemize}
        \item Holdout Methods
        \item Validation Set
        \item k-Fold cross-validation
    \end{itemize}
\end{itemize}

\section{Artificial Neural Networks}
\label{sec:Foundations:NeuralNetworks}

\todo[inline]{General quick introduction to neural networks.}

\subsection{Feedforward Neural Networks}
\label{sec:Foundations:NeuralNetworks:FNN}

According to \textcite{nielsen2015neural} \acp{ann} were developed by \textcite{rosenblatt1958perceptron}. In \acp{fnn} information flows only from input towards the output. There is no backwards flow of information, hence, the name.
A \ac{nn} is consists of multiple layers which themselves consists of individual neurons.

\subsubsection{Perceptrons and Neurons}
\label{sec:Foundations:NeuralNetworks:Perceptrons}

A perceptron (see \autoref{fig:Foundations:ANNs:Perceptron}) is a type of artificial neuron that consists of inputs ($x_1, \cdots, x_n$), weights ($w_1, \cdots, w_n$) that correspond to each input, a threshold/bias $b$ and an output \cite{nielsen2015neural}.

\begin{figure}
    \centering
    \missingfigure{Add figure showing a perceptron.}
    \caption{Visualization of a perceptron.}
    \label{fig:Foundations:ANNs:Perceptron}
\end{figure}

A perceptron computes its output by multiplying each input with its corresponding weight. The result of these multiplications in then summed and compared to a threshold value. \autoref{eq:Perceptron} shows this computation.

\begin{equation}
    output = 
    \begin{cases}\label{eq:Perceptron}
    0 & if:\; \sum_{1}^{n}(w_i \cdot x_i) + b \le 0 \\
    1 & if:\; \sum_{1}^{n}(w_i \cdot x_i) + b > 0
    \end{cases}
\end{equation}

The equation can be simplified by denoting ($x_1, \cdots, x_n$) and ($w_1, \cdots, w_n$) as vectors $x$ and $y$:

\begin{equation}
    output = 
    \begin{cases}\label{eq:PerceptronVector}
    0 & if:\; \vec{w} \cdot \vec{x} + b \le 0 \\
    1 & if:\; \vec{w} \cdot \vec{x} + b > 0
    \end{cases}
\end{equation}

Today, \acp{nn} do not use classical perceptrons. Instead of applying a threshold function to $\vec{w} \cdot \vec{x} + b$ the neurons apply a non-linear activation function. This gives neural networks the capability to approximate non-linear functions \cite{cybenko1989approximation, hornik1991approximation, sharma2020activation}.

\subsubsection{Activation Function}
\label{sec:Foundations:NeuralNetworks:ActivationFunction}

\todo[inline]{write section}

\todo[inline, caption={}]{
    \begin{itemize}
        \item ReLU (for \cite{senaras2018deepfocus})
        \item SoftMax (for \cite{senaras2018deepfocus})
    \end{itemize}
}


\subsubsection{Layer}
\label{sec:Foundations:NeuralNetworks:Layer}

Neurons and their corresponding activation functions are combined into layers. The first layer is called the input layer and the last layer the output layer \cite{nielsen2015neural}. Layers in between are referred to as hidden layers. In fully connected neural networks \todo{source} each neuron of each layer is connected to each neuron of the previous layer. Layers that have this property are commonly called fully connected layers \todo{source}. 

Commonly, fully connected neural networks are shown as a graph (see \autoref{fig:Foundations:ANNs:Layer:FullyConnected}), however, mathematically, each layer is represented as a matrix of weights $\mat{W}$ and a vector of biasses $\vec{b}$. Each row vector $\vec{w_i}$ of the matrix corresponds to one neuron and the scalar $b_i$ constitutes the bias for neuron $i$. When processing input $\vec{x}$ the weight matrix is multiplied with the input vector, the bias vector $\vec{b}$ is then added, and, lastly, an activation function $f$ is applied (see \autoref{eq:FCNNLayer}).

\begin{equation}
    \label{eq:FCNNLayer}
    output = f(\mat{W} \cdot \vec{x} + \vec{b}) = f( \begin{pmatrix}
        \vec{w_1} \cdot \vec{x} + b_1\\
        \vdots \\
        \vec{w_n} \cdot \vec{x} + b_n
      \end{pmatrix} )
\end{equation}

\begin{figure}
    \centering
    \missingfigure{Add figure showing a two hidden layer nn with labels on input output and hidden layer.}
    \caption{Visualization of simple neural network with two hidden layers.}
    \label{fig:Foundations:ANNs:Layer:FullyConnected}
\end{figure}

\subsubsection{Optimizer}
\label{sec:Foundations:NeuralNetworks:Optimizer}

\todo[inline, caption={}]{
    \begin{itemize}
        \item SDG (for \cite{senaras2018deepfocus})
    \end{itemize}
}


\subsection{Convolutional Neural Networks}
\label{sec:Foundations:NeuralNetworks:CNN}

\Acp{cnn} are \aclp{fnn}, however, instead of using fully connected layers, \ac{cnn} use filters or convolutions \cite{teuwen2020convolutional}. Convolutions and filters consist of a filter matrix which can be understood as a sliding window. The values of the convolution matrix are multiplied with their corresponding pixel values and summed (see \autoref{fig:Foundations:ANNs:CNNs:Convolution}). Convolutions stem from traditional image processing \cite{shih2010image} and are used because they take the spacial structure of images directly into account \cite{nielsen2015neural}. Instead of having predefined filter matrices convolutional neural networks learn their values during training. \todo{Illustrate how a layer exactly works}

\begin{figure}
    \centering
    \missingfigure{Add figure illustrating how convolutions work.}
    \caption{An illustration of convolutions work.}
    \label{fig:Foundations:ANNs:CNNs:Convolution}
\end{figure}


\subsection{Architecture}
\label{sec:Foundations:NeuralNetworks:Architecture}

Architecture descriptions often describe activation functions as separate layers as can be seen in \todo{ref architecture}.

\todo[inline]{Only explain used architectures}

\begin{itemize}
    \item Building Blocks (how do they work, what they are used for, parameters etc.)
    \begin{itemize}
        \item Fully connected
        \item Convolutional Layers (make sure to not repeat \autoref{sec:Foundations:NeuralNetworks:CNN})
        \item Dropout
        \item Pooling
        \item Batch normalization
    \end{itemize}
    \item VGG
    \item ResNet
    \item Inception
    \item Xception
\end{itemize}

\section{Related Works}
\label{sec:Foundations:RelatedWorks}

\begin{itemize}
    \item DeepFocus \cite{senaras2018deepfocus}
    \begin{itemize}
        \item What they do:
        \begin{itemize}
            \item Classification of in focus not in focus (steps of \unit{-0.5}{\micro\meter} to \unit{0.5}{\micro\meter} are in focus)
            \item 216,000 (108,000 for each class) tiles for training
            \item Scale image values between 0 and 1 + zero-centering (average value of an image is 0)
            \item CNN
            \item SDG
            \item Batch norm after ReLU
            \item Spearman's rank coefficient
            \item 40x magnification where the pixel size is \unit{0.2461}{\micro\meter} x \unit{0.2461}{\micro\meter}
        \end{itemize}
        \item Results: 
        \begin{itemize}
            \item Faster and more accurate than competition
        \end{itemize}
    \end{itemize}
    \item ConvFocus \cite{kohlberger2019wholeslide}
    \begin{itemize}
        \item What they do:
        \begin{itemize}
            \item Classification (degree of out of focussness 30 classes)
            \item pathology
            \item 40x with pixel size \unit{0.251}{\micro\meter} x \unit{0.251}{\micro\meter} and \unit{0.227}{\micro\meter} x  \unit{0.227}{\micro\meter}
            \item Used three human raters to classify patches as in focus or out of focus
            \item 166,000 patches as in focus 
            \item Images are blurred with Gaussian or Bokeh blur to varying degree. This yielded bad performance therefore artificial jpeg artifacts were added after blurring. Pixel-wise poisson noise was simulated. JPG encoding artifacts.
            \item For testing used manually gradet real OOF images and
            \item also collected z-stacks with (\unit{+4}{\micro\meter} to \unit{-4}{\micro\meter}) increments \unit{0.4}{\micro\meter} (relative to scanners-determined focus-depth)
            \item Inception v3 architecture truncated 
            \item Spearman's rank coefficient
            \item Later test cancer detector based on level of out of focus-ness.
        \end{itemize}
        \item Results
        \begin{itemize}
            \item Shows that synthetical blurring can be a good tool to generate sufficient a amount of data
            \item Cancer detection results dropped continuously with more out of focus images
        \end{itemize}
    \end{itemize}
    \item FocusLite \cite{wang2020focuslitenn} 
    \item Autofocus of whole slide imaging based on convolution and recurrent neural networks \cite{xiang2021autofocus}
    \item Traditional methods \cite{redondo2012autofocus}
    \item Squared gradient (potentially traditional method)
    \item Gradient Boosting \cite{liang2019learning}

\end{itemize}


